# Exchange-Specific Expiry Rules

# CME Group Metals - Copper (HG)
# Official Rule: Trading terminates on the third last business day of the maturing
# delivery month. Trading in expiring contract terminates at 12:00 noon CT.
#
# Example: For January 2024 (HGF24):
# - Find the last business day of January 2024
# - Count back 3 business days from that
# - That's the last trading day

exchanges:
  CME:
    metals:
      HG:  # Copper
        rule: "third_last_business_day"
        description: "Third last business day of delivery month"
        termination_time: "12:00"  # Noon CT
        delivery_months: [3, 5, 7, 9, 12]  # H, K, N, U, Z - main months
        all_months: true  # Also trades non-delivery months (F, G, J, M, Q, V, X)
        tick_size: 0.0005  # $0.0005 per pound
        contract_size: 25000  # 25,000 pounds
        point_value: 12.50  # $12.50 per tick

      GC:  # Gold
        rule: "third_last_business_day"
        description: "Third last business day of delivery month"
        termination_time: "12:30"
        delivery_months: [2, 4, 6, 8, 10, 12]  # G, J, M, Q, V, Z
        tick_size: 0.10
        contract_size: 100
        point_value: 10.00

      SI:  # Silver
        rule: "third_last_business_day"
        description: "Third last business day of delivery month"
        termination_time: "12:25"
        delivery_months: [3, 5, 7, 9, 12]
        tick_size: 0.005
        contract_size: 5000
        point_value: 25.00

    energy:
      CL:  # Crude Oil
        rule: "third_business_day_before_25th"
        description: "Third business day prior to the 25th of the month preceding delivery"
        termination_time: "14:30"
        delivery_months: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]
        tick_size: 0.01
        contract_size: 1000
        point_value: 10.00

      NG:  # Natural Gas
        rule: "three_business_days_before_first_of_month"
        description: "Three business days prior to the first calendar day of the delivery month"
        termination_time: "14:30"
        delivery_months: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]
        tick_size: 0.001
        contract_size: 10000
        point_value: 10.00

    agriculture:
      ZC:  # Corn
        rule: "business_day_before_15th"
        description: "Business day preceding the 15th of the contract month"
        termination_time: "12:00"
        delivery_months: [3, 5, 7, 9, 12]  # H, K, N, U, Z
        tick_size: 0.25
        contract_size: 5000
        point_value: 12.50

      ZS:  # Soybeans
        rule: "business_day_before_15th"
        description: "Business day preceding the 15th of the contract month"
        termination_time: "12:00"
        delivery_months: [1, 3, 5, 7, 8, 9, 11]  # F, H, K, N, Q, U, X
        tick_size: 0.25
        contract_size: 5000
        point_value: 12.50

      ZW:  # Wheat
        rule: "business_day_before_15th"
        description: "Business day preceding the 15th of the contract month"
        termination_time: "12:00"
        delivery_months: [3, 5, 7, 9, 12]
        tick_size: 0.25
        contract_size: 5000
        point_value: 12.50

# Expiry rule implementations
rule_definitions:
  third_last_business_day:
    description: |
      Find the last business day of the delivery month,
      then count back 3 business days (including the last day).
      Example: If last business day is Jan 31, count back 3 = Jan 29.

  third_business_day_before_25th:
    description: |
      Find the 25th of the month PRIOR to delivery month.
      Count back 3 business days from the 25th.
      If 25th is not a business day, start from the prior business day.

  three_business_days_before_first_of_month:
    description: |
      Find the first calendar day of the delivery month.
      Count back 3 business days.

  business_day_before_15th:
    description: |
      Find the 15th of the contract month.
      If 15th is a business day, expiry is the prior business day.
      If 15th is not a business day, expiry is the business day before the 15th.
